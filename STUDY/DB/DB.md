# DB



## 主キー
- データベースのデータを一意に識別するための項目のこと

### 復号キー（復号主キー）
- 1つの項目ではなく、複数の項目を主キーとして組み合わせデータを一意に識別すること


## 整合性制約
### 一意制約  	
- データに重複がなく、必ず一意であること。
- 主キーの項目（カラム）に同じデータが登録された場合、この一意制約でエラーとなる。

### NOT NULL制約	  
- NULLを許可しない。主キーの項目（カラム）にNULLが登録された場合、このNOT NULL制約でエラーとなる。



## 外部キー(Foreign Key)
- 他の表を参照するために設定される属性のこと。
- 参照整合性を保つため参照する側の属性には参照される側の表に存在しない値を含むことができない外部キー制約が課される。


## 候補キー(Candidate Key)
- 主キーの候補となるキーのことで、表の中の1つのレコードを特定できる性質を持つ属性、または属性の組合せ。
- 候補キーではnull値が許されます。候補キーにNOT NULL制約を加えたものが主キー制約となる

- 1つの表に複数の候補キーがある場合には、その中で項目の組合せが最小でその表の性質にあったものが主キーとして選択される。



## 関数従属性
- リレーショナルデータベース（RDB）の表で、2つの属性の間で片方の値を決定するともう一方の値が一意に決まるという性質のこと



# 正規化

- 第1正規化
    - 繰り返し項目をなくす
    - 全ての属性が単一値である状態
- 第2正規化
    - 主キーの一部によって一意に決まる属性を別表に移す
    - 第1正規形を満たし、かつ、主キーに部分関数従属する（主キーの真部分集合に関数従属する）属性が存在しない状態
- 第3正規化
    - 主キー以外の属性によって一意に決まる属性を別表に移す
    - 第2正規形を満たし、かつ、主キーからの推移的関数従属が存在しない状態


![正規化](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/normalization_1.png)
![正規化](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/normalization_2.png)



- 正規化は、データの冗長性を排除して、データの一貫性と整合性を保つために行われます。
    - 逆に正規化を行うと表が複数に分割されるので、結合などに余分な処理時間がかかるようになり、アクセス効率が下がることもあります。

- 正規化を行うと，複数の項目で構成される属性は，単一の項目をもつ属性に分解される。
- 繰り返し項目を持つレコードは、第1正規化の段階でそれぞれの単独のレコードに分割されます。


- 多対多の関係は関係データベースとして実装することができない（非正規形になる）



## 参照制約
- 外部キーを持つ表にレコードを追加する場合に、その外部キー列の値は参照先の表の主キーとして存在するものでなければならない、また、別表から主キーの値を参照されている行は削除することができないという制限を課す制約です。

- 参照制約は、関係データベースの整合性を保つために設定され、その指定には次のように"FOREIGN KEY"と"REFERENCES"が使われます。  

    - FOREIGN KEY 列リスト 
    - REFERENCES 親テーブル(列リスト)  


検査制約は、テーブルに格納されるデータの種類を一定の範囲や種類に限定するための方法です。

検査制約を設けるには、CREATE TABLE文でテーブルを作成するときの属性(列)の定義を

　CHECK(属性名 検査式)

という形式で記述することで、特定の列の値が任意の式を満たすように指定できます。


## キー制約
- キー制約は、PRIMARY KEY句やFOREIGN KEY句を用いて指定します。

## 検査制約
- 検査制約は、CHECK句を用いて指定します。

## 表明
- 表明は、整合性制約の一種でCREATE ASSERTION句で指定します。




## 関係演算




## データベースを設計する際の論理データモデル作成の手順
## トップダウンアプローチ
- E-R図などで表される概念データモデルをもとに具体化を進める方法。
- 概念的なモデルに基づき、将来的な拡張性を含めた理想的な設計を行なえる可能性があるが、逆にユーザニーズを十分反映できない場合もある。

## ボトムアップアプローチ
- ユーザが利用している画面や帳票を抽象化してモデル化を行なう方法。
- 直近のユーザニーズを的確に反映することができるが、将来的な拡張性、柔軟性にかけたモデルになる可能性がある



## べき等(Idempotent)
- 同一の操作を複数回実行した結果と，一回しか実行しなかった結果が同一になる操作
- コンピュータサイエンスの世界で使われる言葉で、ある操作を1回実行しても複数回実行しても結果が同じになる性質です。
- 主要なデータ操作SQL文のうち、SELECTと障害回復時のUNDO・REDOはべき等、INSERT・UPDATE・DELETEはべき等ではありません。

## 原子性
- トランザクション内の全ての処理が成功したか，何も実行されなかったかのいずれかの結果にしかならない操作

## レプリケーション
- 一つのノードへのレコードの挿入処理を，他のノードでも実行する操作

## 直列化可能または一貫性
- 複数のトランザクションを同時に実行した結果と，順番に実行した結果が同一になる操作



## ANSI/SPARC 3層スキーマ
概念スキーマ、外部スキーマ、内部スキーマの3つのグループに分けてデータ定義を行うデータベースモデル

- 物理的・論理的データの独立性を達成するためにDBMSがサポートすべきアーキテクチャとして提案されたものです。

### 概念スキーマ
- データベース化対象の業務とデータの内容を論理的なデータモデルとして表現したもの。
- 概念スキーマを記述するために記号系にはリレーショナルモデルの他にも、ネットワークモデル、階層型モデルなどがある。リレーショナルモデルではE-R図の作成、表定義、表の正規化が概念スキーマに相当する。

### 外部スキーマ
- 概念スキーマで定義されたデータモデル上に利用者ごとの目的に応じた見方を表現したもの。
- リレーショナルモデルのビューやネットワークモデルのサブスキーマが外部スキーマに相当する。

#### サブスキーマ
外部スキーマの別称。

### 内部スキーマ
- 概念スキーマで定義されたデータモデルを記憶装置上にどのような形式で格納するかを表現したもの。
- ファイル編成やインデックスの設定などが内部スキーマに相当する。


![3層スキーマ](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/3tier_schema.png)



## ボイス・コッド正規形
- 第3正規形の条件を満たしつつ、すべての列が主キーに完全関数従属で、他に完全関数従属関係がないものを言います


## オブジェクト指向データベース
- データとその操作手続を併せもったデータ構造を扱う。
- 関係データモデルをオブジェクト指向データモデルに拡張し、オブジェクト指向プログラミングで使うオブジェクトの形式で表現される操作の定義や型の継承関係の定義を格納できるデータベースモデルです。


## 階層型データベース
- 階層構造によって，データの関係を表現する。

## ネットワーク型データベース
- 関連するデータを，ポインタで結合する。

## 関係データベース
- データの集合を幾つかの2次元の表によって表現する。




# SQL


## ストアドプロシージャ(Stored Procedure)
- データベースに対する一連の処理をまとめた手続きにして、データベース管理システムに保存したもの
- 利用者は通常のクエリを発行する代わりに、データベース管理システム内の手続きを呼び出すことによって目的の処理を実行させることができます。

- クライアントからサーバに対してのストアドプロシージャ1回の要求で、データベースに複数のクエリを発行することができるので、クライアントから直に同数のクエリを発行する場合と比較して、クライアントとサーバ間の通信負荷の軽減が期待できます。


演算子 IN，EXISTS，ALL 及び ANY は、値の集合や副問合せ(サブクエリ)からの結果セットに対して「真(True)」又は「偽(False)」の評価を行い、主問合せ(メインクエリ)のWHERE句で使用されます。

それぞれの演算子は以下のような評価を行い真偽を返します。
IN
結果セットの値のうちいずれかに一致すれば真を返し、そうでなければ偽を返す。
EXISTS
副問合せの結果セットが1行以上あれば真を返し、そうでなければ偽を返す。
ANY
比較演算子(＝,≧,≦,<>)と共に使用され、副問合せの結果セットの値のうち、いずれかが条件を満たせば真を返し、そうでなければ偽を返す。
ALL
比較演算子と共に使用され、副問合せの結果セットの値の全てが条件を満たした場合にだけ真を返し、そうでなければ偽を返す。


LIKE句は、指定したパターンと文字列比較を行うための演算子で、次の特殊記号を用いて文字列のパターンを指定します。
"%"(パーセント)
0文字以上の任意の文字列
"_"(アンダースコア)
任意の1文字

埋込みSQLとは、C、COBOL、Pascal、Javaのような手続き型プログラミングに関係データベースを操作するためのSQLを埋め込む手法です。

カーソル操作は、アプリケーションプログラムからデータベースへの問合せによって得られた導出表を、表データを直接扱えない手続き型プログラム言語に1行ずつ渡す機能を提供するものです。SQLではカーソル宣言に"DECLARE CURS



CLUSTERING(クラスタリング)は、複数のコンピュータを結合し、葡萄の房(クラスタ)のようにひとまとまりとしてふるまわせる技術です。SQLの1つであるCLUSTER句は表をクラスタ構成にする文です。




## CASCADE
- 参照される側の行が削除・更新された場合、それを参照する側の行も同時に削除・更新する指定です。

## INTERSECT（共通）
- 2つの関係に共通集合を得る演算
- 複数の表から両方に共通する行を抽出する集合演算を行うSQL文です。積集合を求めるのに使います。

## RESTRICT
- 参照制約性を損なう削除や更新処理の要求に対して、データ更新または削除を禁止する指定です。

## UNIQUE
- データベースにデータを追加したり更新する際に、列や列のグループに格納される値が表内のすべての行で一意となるように制限する指定です。

![DataBase](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/DataBas_e.png)
![DataBase](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/DataBase.png)



CONNECT文は、データベースへの接続を確立するSQL文
CREATE ASSERTION文は、スキーマ内の複数のテーブルに対して制約を適用するSQL文です。

GRANT文は、特定のユーザに表などのデータベースオブジェクトに対する権限を付与するSQL文です。

```
GRANT オブジェクトの権限 ON オブジェクト名
　　TO { ユーザ名 | ロール名 | PUBLIC }
　　[ WITH GRANT OPTION ]
```

反対に付与されている権限を取り消すには、REVOKE文を使用します。
REVOKE オブジェクトの権限 ON オブジェクト名
　　FROM { ユーザ名 | ロール名 | PUBLIC }



パスワードを設定してデータベースへの接続を制限する。
ALTER USER文の説明です。
ビューを作成して，データベースへのアクセス処理を隠蔽し，表を直接アクセスできないようにする。
CREATE VIEW文の説明です。
表のデータを暗号化して，第三者がアクセスしてもデータの内容が分からないようにする。
CREATE TABLE文またはALTER TABLE文の説明です。



射影は、関係演算の1つで関係(表)の中から特定の属性(列)の集合を取り出す操作です。

SQLでは1つの表に同じ内容が2回以上出現することを許容しますが、数学の集合論に基づく関係モデルでは要素の重複が許されません。すなわち厳格に言えば、射影は「列の取り出し→重複の排除」を組み合わせた操作だということになります。

DISTINCTは、選択された行から重複行を取り除くよう指定する字句です。
ORDER BYは、結果セットを昇順または降順に整列して表示するために指定する字句です。
REFERENCESは、属性に外部キー制約を付けるために指定する字句です。

EXISTSは副問合せの結果が1行以上あるときに真を返す

## UNION（和）
- 2つの関係の和集合を得る演算


## CROSS JOIN（直積）
- 2つの関係に存在する行のすべての組み合わせを得る演算

- 直積(cartesian product)
![直積](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/cartesian_product.png)



## INNER JOIN（内部結合）
- 2つの関係を共通する属性で結び付ける演算


![DB_SELECT](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/DB_SELECT_1.png)
![DB_SELECT](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/DB_SELECT_2.png)
![DB_SELECT](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/DB_SELECT_3.png)



導出表は、1つ以上の基礎となる実表(DBに実データを持つ表)から関係演算・集合演算といったSQL問合せによって作成される仮想的な表全般を指します。SELECT文で得られる結果の他にも、GROUP BY句やWITH句を処理する際に内部的に作られる一時的な表も導出表の1つです。ビューは導出表の一つの形態であり、導出表に名前を付けて実表と同じように参照(条件次第では更新も)できるようにしたものです。

実表に対する射影，結合などによって導出表が得られる。
導出表は、1つ以上の実表に関係演算等を行って得られる表です。

導出表は実データを持たず、参照・更新要求の度に、実表に関係演算・集合演算を行って作り出されています。





更新可能なビューとは、実表に対して行を挿入、更新または削除できるビューです。ビューを更新可能とするためには、ビュー定義に次に挙げる構造を含めてはいけません。
集約関数（AVG、COUNT、SUM、MIN、MAXなど）
2つ以上の表の結合（更新可能な結合，和集合及び列を除く）
GROUP BY、ORDER BY、MODEL、CONNECT BY、START WITH、DISTINCTの各句
SELECT構文のリストにコレクション式
SELECT構文のリストにある副問合せ
WITH READ ONLYが指定された副問合せ






CAP定理は、分散処理システムにおいては、一貫性・可用性・分断耐性の3つの特性のうち、最大でも同時に2つまでしか満たすことができないとする定理です。本問の"整合性"は一貫性と同じ意味と考えてください。
一貫性（Consistency）
データの整合性が常に保たれていること
可用性（Availability）
利用したいときに求める分だけ利用できること
分断耐性（Partition Tolerance）
データを複数のサーバに分散して保管していること
一貫性と可用性を保証しようとすると必然的に単一のデータベースとなり、分断耐性がありません。また、一貫性と分断耐性を保証しようとすると、データベースの2相ロックや3相ロックが必要となり可用性が損なわれます（ロック中は利用できない）。そして、可用性と分断耐性を保証するシステムでは、ロックを掛けないので一貫性が損なわれます。


![CAP](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/CAP.png)  





分散データベースシステムは、地理的に離れた場所にある複数のデータベースを論理的にまとめて1つのデータベースとしてアクセスできるようにしたものです。分散データベースを利用する際に、データベースが複数の場所に離れていることを意識せずに利用するために求められる性質を「透過性」といい、次の6つの種類があります。
位置に対する透過性(location transparency)
利用者はそれが配置されている位置を意識せずにデータベースを利用できること
移動に対する透過性(migration transparency)
データの格納サイトが変更されても、利用者のアプリケーションや操作方法に影響がないこと
分割に対する透過性(fragmentation transparency)
一つの表が複数のサイトに分割されて格納されていても、利用者はそれを意識せずに利用できること
複製に対する透過性(replication transparency)
同一のデータが複数のサイトに格納されていても、利用者はそれを意識せずに利用できること
障害に対する透過性(failure transparency)
あるサイトで障害が発生しても、利用者はそれを意識することなく利用できること
データモデルに対する透過性(data model transparency)
各サイトのDBMSが扱うデータモデルが異なっていても、利用者はそれを意識することなく利用できること




グラフ指向DBは、有向グラフと呼ばれるデータ構造でデータを格納するデータベースで、データエンティティ(実体)を表す「ノード」、ノード間の関連をタイプと方向をもって表す「エッジ」、ノードとエッジの属性情報を"key-value"形式で保持する「プロパティ」の3要素で構成されます。SNSにおけるユーザの関係やWebサイト同士のリンク構造などの高度な"つながり"を表すデータモデルに適しています。

![グラフ指向DB](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/graph_orientedDB.png)  

データ項目の値として階層構造のデータをドキュメントとしてもつことができる。また，ドキュメントに対しインデックスを作成することもできる。
ドキュメント指向DBの特徴です。
ノード，リレーション，プロパティで構成され，ノード間をリレーションでつないで構造化する。ノード及びリレーションはプロパティをもつことができる。
正しい。グラフ指向DBの説明です。
一つのキーに対して一つの値をとる形をしている。値の型は定義されていないので，様々な型の値を格納することができる。
キーバリューストア(KVS)の説明です。
一つのキーに対して複数の列をとる形をしている。関係データベースとは異なり，列の型は固定されていない。
カラム指向DBの説明です。




データレイク(Data Lake)とは、川の流れのように絶えず流れ込んでくる多種多様な生データを、その規模にかかわらず、本来のフォーマットのまま蓄積しておく巨大な"貯水湖"です。蓄積するデータの生成元には、Webサイトやソーシャルメディア、モバイルアプリ及びIoTデバイスなどを含みます。
蓄積されたデータは、機械学習、予測分析、データ検出、プロファイリングなどに役立てられますが、どのように使用するかは基本的に利用者に任せられています。収集する範囲を決めずにそのままのデータが一元的に管理されているため、分析の際に求めるデータが不足したり、他システムから寄せ集めたりといった問題がなくなります。

データウェアハウスに格納されたデータから特定の用途に必要なデータだけを取り出し，構築する。
データマートの説明です。

基幹業務のデータベースとは別に作成され，更新処理をしない集計データの分析を主目的とする。
データウェアハウスの説明です。
個人別データ，部門別データ，サマリデータなど，分析の目的別に切り出され，カスタマイズされたデータを分析する。
データマートの説明です。

ETLは、Extract，Transform，Loadというデータウェアハウス構築における3つの工程の頭文字を合わせた言葉です。
Extract(抽出)
企業内に存在する複数のシステムからデータを抽出し、それぞれの異なるデータフォーマットを次の加工工程に適した同一のデータフォーマットに変換する。
Transform(変換・加工)
抽出した生データにデータ形式の統一、欠損値の補完、単位の統一、異常値の処理などを行い、データの書き出しができる状態にする。(データクレンジング)
Load(ロード・書き出し)
データウェアハウスなどの出力先に書き出す。
ETLツールは、これら一連の処理をGUIで開発できるソフトウェアです。専用プログラムの自社開発はコストがかかるため汎用的に使用できるETLツールを購入する企業が増えています。


データウェアハウスを構築する際に使用される元データは、仕様の異なる様々なシステムに蓄積されていた形式がバラバラなデータ群であり、このままではデータマイニングなどの解析で使用することができません。

この生データを解析で使用できるようにするために行われるのが、データクレンジング(=洗浄)です。データクレンジングの作業で、データ形式の統一、欠損値の補完、単位の統一、異常値の処理などの処理をされたデータによってデータウェアハウスは構築されます




データウェアハウスやデータマートからデータを取り出し，多次元分析を行う。
スライシング，ダイシング，ドリルダウンなどのインタラクティブな操作によって多次元分析を行い，意思決定を支援する。
OLAP(Online Analytical Processing)の説明です。





データディクショナリ/ディレクトリ(DD/D)は、メタデータやデータ定義情報を効率よく管理する仕組みです。

データディクショナリ/ディレクトリは、それぞれのサイトに存在するデータベースごとに存在しますが、分散データベースでは「資源位置に対する透過性」を満たすためにこれに加えて、どのサイトからもアクセスが可能なグローバルなデータディクショナリ/ディレクトリを用意する必要があります。

このグローバルなDD/Dの配置方式には「集中管理方式」と「分散管理方式」があります。
集中管理方式
1つのサイトが代表してすべてのDD/Dを保有する方式。
管理は容易になるが、負荷が集中してしまう点やサイトの障害によって分散データベースが利用できなくなってしまう欠点がある。
分散管理方式
DD/Dを複数のサイトに分散して保有する方式。さらに分散管理は、全てのサイトで重複してDD/Dを保有する方式と、重複なく保有する方式に分類することができる。
[重複保有あり]
自サイトが必ず必要な情報をもっているので、他のサイトに問い合わせる必要がないが、データ更新の際には全てのサイトのDD/Dを修正する必要がある。
[重複保有なし]
自サイトがもたない情報は他のサイトに問い合わせる必要があるが、データの更新の際にはその情報をもつサイトの内容だけを修正するだけで済む。



データディクショナリ(DD)は、データベースのメタデータやデータ定義情報を効率よく管理する情報の保管庫です。データディクショナリは、他のデータベースと同じく表とビューで構成されていて次のような情報が格納されています。
概念スキーマ、外部スキーマ、内部スキーマとそれらの変換定義情報
表、ビュー、インデックス、その他オブジェクトの定義情報
参照制約、検査制約の定義情報
ユーザ情報
アクセス権と機密保護に関する情報



NoSQL(Not only SQL)は、データへのアクセス方法をSQLに限定しないデータベース管理システムの総称で、長い間決まったように使用されてきた関係データベース管理システム以外のDBMSという意味で用いられます。

RDBMSは長い歴史をもち、厳密なスキーマ定義や数学的に定義されたモデル理論、トランザクションのACID特性などによって信頼性に秀でています。しかし、それゆえにデータを扱う際のコストも高くなり、ビッグデータなどの高頻度で膨大なデータを扱う場面ではパフォーマンス面での劣化が現れてきました。
NoSQLは、スキーマレスで軽量なのでデータの参照や追加を低コストで実行できます。さらにスケーラビリティにも優れるため大量に蓄積されていくデータを扱うのに適しています。

![RDBMS_NoSQL](https://github.com/MediumMountain/Study_Security/blob/main/PICTURE/DB/RDBMS_NoSQL.png)  

NoSQLには大まかに分けて4つのタイプがあります。
キー・バリュー型
1つのキーに1つの値を結びつけてデータを格納する
カラム指向
行キーに対してカラム（名前と値の組み合わせ）を結びつけて格納する
ドキュメント指向
XMLやJSONなどの構造でデータを格納する
グラフ指向
グラフ理論に基づいてデータ間の関係性を表現する




多次元データベースとは、エンドユーザーが直接にデータベースを検索加工して問題発見をしたり問題解決をする分析を主とする利用目的のために適しているとされるデータベース。例えば月別・商品別の売上データを横に月，縦に商品をとれば２次元の表になります。月別・商品別に支店別を加えた売上データは3次元の表になります。さらに月別・商品別・支店別で売上，原価，利益のような会計区分を加えれば4次元になるというように表の次元は増大する。このような表の形式にしたものを多次元データベースといいます。


http://www.kogures.com/hitoshi/webtext/db-mddb/index.html

データクレンジング(=洗浄)
データウェアハウスを構築するために，業務システムごとに異なっているデータ属性やコード体系を統一する
この生データを解析で使用できるようにするために行われるのが、データクレンジング(=洗浄)です。データクレンジングの作業で、データ形式の統一、欠損値の補完、単位の統一、異常値の処理などの処理をされたデータによってデータウェアハウスは構築されます。


ドリルダウン
多次元データベースにおいて、詳細に展開する操作を指します。（例 :四半期集計データから月集計データに移ること）
逆に集計レベルを高く(広く)する操作をドリルアップといいます。
ロールアップ
多次元データベースにおいて、集計レベルを高くする操作を指します。(例 :集計単位を1カ月→1年)
ドリルダウンの反対なので、ドリルアップとも呼ばれます。


ダイス
ダイスとはサイコロのことで、多次元データベースの中から縦軸と横軸を指定して2次元の表にする操作を指します。3次元であるサイコロを振ると見えている面が変わるように、縦横の項目を変えて多次元データのまったく違う面を表にする機能のことです






RDA(Remote Database Access)は、遠隔地のデータベースを操作するためのプロトコルで、ANSI/ISO/IEC 9579-1，9579-2として1993年に国際規格化されています。
RDAにはクライアントから遠隔地のデータベースにSQL文を転送し、処理結果を返すデータベース操作の仕組みのほか、アソシエーション管理、資源ハンドリング、トランザクション管理などの機能が規定されています。
CORBA
Common Object Request Broker Architectureの略。オブジェクト指向技術標準化団体(OMG)がまとめたオブジェクト指向による分散処理環境を実現するための国際標準仕様です。
DDL
Data Definition Languageの略。SQL言語のうちデータベースの構造や構成を定義する命令群です。
RDA
正しい。
RPC
Remote Procedure Callの略。Remote(遠く隔たった)，Procedure(手続き)，Call(呼び出し)の言葉の意味通り、実行中のプログラムと別のアドレス空間(通常は共有ネットワーク上の別のコンピュータ)にあるサブルーチンや手続きを実行することを可能にする技術です。